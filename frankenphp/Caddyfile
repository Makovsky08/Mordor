{
    {$CADDY_GLOBAL_OPTIONS}
    # Disable automatic HTTPS
    auto_https off


frankenphp {
    {$FRANKENPHP_CONFIG}
}

# https://caddyserver.com/docs/caddyfile/directives#sorting-algorithm
    order mercure after encode
    order vulcain after reverse_proxy
    order php_server before file_server

}

{$CADDY_EXTRA_CONFIG}

http://64.226.86.163 {
    log {
        # Redact the authorization query parameter that can be set by Mercure
        format filter {
            wrap console
            fields {
                uri query {
                    replace authorization REDACTED
                }
            }
        }
    }

    root * /app/public
    encode zstd gzip

    vulcain

    # Disable Topics tracking if not enabled explicitly: https://github.com/jkarlin/topics
    header ?Permissions-Policy "browsing-topics=()"

    php_server
}
